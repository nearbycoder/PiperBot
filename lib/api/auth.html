<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.1/fetch.js"></script>
  </head>
  <body>
    ...Sending Token To PiperBot
  </body>
  <script>
    var token = getHashParams().token;
    var url = window.location.origin + window.location.pathname + '/' + token
    history.replaceState([], 'PiperBot', '/');
    fetch(url)
    .then(function(response) {
      return response.json();
    })
    .then(function(results) {
      document.body.innerHTML = "Authorized to use Trello with PiperBot"
    });

    function getHashParams() {
        var hashParams = {};
        var e,
            a = /\+/g,  // Regex for replacing addition symbol with a space
            r = /([^&;=]+)=?([^&;]*)/g,
            d = function (s) { return decodeURIComponent(s.replace(a, " ")); },
            q = window.location.hash.substring(1);
        while (e = r.exec(q))
           hashParams[d(e[1])] = d(e[2]);
        return hashParams;
    }
  </script>
</html>